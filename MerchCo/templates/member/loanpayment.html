<div class="card mt-50 mb-50">
    <a href="{% url 'welfareview' %}" class="back-arrow">⬅ </a>
    <div class="card-title mx-auto">
        Loan Payment
    </div>
    <div class="nav">
        <ul class="mx-auto">
            <!-- <li><a href="#">Account</a></li> -->
            <li class="active"><a href="#">Payment</a></li>
        </ul>
    </div>
     <form method="post" action="{% url 'loanpayment_process' %}">
        {% csrf_token %}
        <input type="hidden" name="amount" value="{{loan.amount}}">
        <input type="hidden" name="monthlyamount" value="{{loan.monthlyamount}}">
        <input type="hidden" name="loan" value="{{loan.loan_id}}">

        <span id="card-header">Saved cards:</span>
        <div class="row row-1">
            <div class="col-2"><img class="img-fluid" src="https://img.icons8.com/color/48/000000/mastercard-logo.png"/></div>
            <div class="col-7">
                <input type="text" placeholder="**** **** **** 3193">
            </div>
            <div class="col-3 d-flex justify-content-center">
                <a href="#">Remove card</a>
            </div>
        </div>
        <div class="row row-1">
            <div class="col-2"><img class="img-fluid" src="https://img.icons8.com/color/48/000000/visa.png"/></div>
            <div class="col-7">
                <input type="text" placeholder="**** **** **** 4296">
            </div>
            <div class="col-3 d-flex justify-content-center">
                <a href="#">Remove card</a>
            </div>
            <input type="hidden" name="amount" value="{{ loan.amount }}">
            <input type="hidden" name="monthlyamount" value="{{ loan.monthlyamount }}">
            <input type="hidden" name="loan" value="{{ loan.loan_id }}">
            <input type="hidden" name="due_date" value="{{ request.GET.due_date }}"> <!-- Passing Due Date -->

        </div>
        <span id="card-header">Card Details:</span>
        <div class="row-1">
            <div class="row row-2">
                <span id="card-inner">Payment Details</span>
                <!-- <p>{{welfare.welfare_id}}</p> -->
            </div>
           <div class="row row-2">
    <label for="name" class="form-label">Cardholder Name:</label>
    <input type="text" id="name" placeholder="Enter Name" value="{{loan.member_id.membername}}" name="name" readonly>
</div>

<div class="row row-2">
    <label for="due-date" class="form-label">Payment Due Date:</label>
    <span id="due-date" class="due-date">{{ request.GET.due_date }}</span>
</div>

<div class="row row-2">
    <label for="fine_amount" class="form-label">Fine Amount (₹):</label>
    <input type="text" id="fine_amount" name="fine_amount" value="0" readonly>
    <input type="hidden" name="fine_amount" id="hidden_fine_amount">
</div>



        </div>
        <div class="row three">
            <div class="col-7">
                <div class="row-1">
                    <div class="row row-2">
                        <span id="card-inner">Card number</span>
                    </div>
                    <div class="row row-2">
                        <input type="text" placeholder="xxx-xxx-xxx"  name="cardnumber">
                    </div>
                </div>
            </div>
            <div class="col-2">
                <input type="text" placeholder="Exp. date">
            </div>
            <div class="col-2">
                <input type="text" placeholder="CVV">
            </div>
        </div>

        <button class="btn d-flex mx-auto">
    <b>PAY ₹ <span id="total_amount_display">{{ loan.monthlyamount }}</span></b>
</button>



    </form>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        let dueDateStr = document.getElementById("due-date").textContent;
        let dueDate = new Date(dueDateStr);
        let today = new Date();
        let fineAmount = 0;
        let monthlyAmount = parseFloat("{{ loan.monthlyamount }}");

        if (today > dueDate) {
            let timeDiff = today - dueDate;
            let overdueDays = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            fineAmount = Math.floor(overdueDays / 7) * 100;  // ₹100 per week
        }

        // Update fine amount in textbox
        document.getElementById("fine_amount").value = fineAmount;

        // Update total amount in the button
        let totalAmount = monthlyAmount + fineAmount;
        document.getElementById("total_amount_display").textContent = totalAmount;

        // Ensure fine amount is submitted
        document.querySelector("form").addEventListener("submit", function() {
            document.getElementById("hidden_fine_amount").value = fineAmount;
        });
    });
</script>

<style>
body {
    background: #ddd;
    min-height: 100vh;
    vertical-align: middle;
    display: flex;
    justify-content: center;
    align-items: center;
}
.row-2 {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(221, 228, 236, 0.3);
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}

.form-label {
    font-weight: bold;
    color: #333;
    flex: 1;
}

input, .due-date {
    flex: 2;
    text-align: right;
    font-weight: 600;
    color: #000;
    border: none;
    background: transparent;
}

.card {
    width: 600px;
    padding: 3rem 3.5rem;
    box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    background-color: white;
}

.back-arrow {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: transparent;
            color: #333;
            font-size: 24px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            padding: 8px 15px;
            transition: 0.3s;
        }

        .back-arrow:hover {
            color: #b66dff;
        }
.mt-50 {
    margin-top: 50px;
}

.mb-50 {
    margin-bottom: 50px;
}

.card-title {
    font-weight: 700;
    font-size: 2.5em;
    text-align: center;
}

.nav {
    display: flex;
    justify-content: center;
}
.nav ul {
    list-style-type: none;
    display: flex;
    padding-inline-start: unset;
    margin-bottom: 6vh;
}
.nav li {
    padding: 1rem;
}
.nav li a {
    color: black;
    text-decoration: none;
}
.active {
    border-bottom: 2px solid black;
    font-weight: bold;
}

input {
    border: none;
    outline: none;
    font-size: 1rem;
    font-weight: 600;
    color: #000;
    width: 100%;
    background-color: transparent;
    border-color: transparent;
    margin: 0;
}

form a {
    color: grey;
    text-decoration: none;
    font-size: 0.87rem;
    font-weight: bold;
}
form a:hover {
    color: grey;
}

form .row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 0;
    overflow: hidden;
}

form .row-1 {
    border: 1px solid rgba(0, 0, 0, 0.137);
    padding: 0.5rem;
    outline: none;
    width: 100%;
    border-radius: 5px;
    background-color: rgba(221, 228, 236, 0.301);
    border-color: rgba(221, 228, 236, 0.459);
    margin: 2vh 0;
}

form .row-2 {
    border: none;
    outline: none;
    background-color: transparent;
    margin: 0;
    padding: 0 0.8rem;
}

form .row .col-2, .col-7, .col-3 {
    display: flex;
    align-items: center;
    padding: 0 1vh;
}

form .row .col-2 {
    padding-right: 0;
}

#card-header {
    font-weight: bold;
    font-size: 0.9rem;
}

#card-inner {
    font-size: 0.7rem;
    color: gray;
}

.three .col-7 {
    padding-left: 0;
    width: 50%; /* Adjust the width of the card number box */
}

.three {
    overflow: hidden;
    display: flex;
    justify-content: space-between;
}

.three .col-2 {
    border: 1px solid rgba(0, 0, 0, 0.137);
    padding: 0.5rem;
    outline: none;
    border-radius: 5px;
    background-color: rgba(221, 228, 236, 0.301);
    margin: 2vh 0;
    width: 25%; /* Keep the width of the Exp. date and CVV boxes consistent */
    display: flex;
    align-items: center;
    justify-content: center;
}

.three .col-7 input, .three .col-2 input {
    font-size: 0.7rem;
    padding: 0.7rem;
    height: 50px; /* Set a fixed height for all the input boxes */
}

.three .col-7 input {
    width: 100%; /* Ensure the card number input box fills its container */
}

.btn {
    width: 100%;
    background-color: black;
    border-color: black;
    color: white;
    justify-content: center;
    padding: 2vh 0;
    margin-top: 3vh;
    text-align: center;
}

.btn:focus {
    box-shadow: none;
    outline: none;
}

.btn:hover {
    color: white;
}

input:focus::-webkit-input-placeholder {
    color: transparent;
}

input:focus:-moz-placeholder {
    color: transparent;
}

input:focus::-moz-placeholder {
    color: transparent;
}

input:focus:-ms-input-placeholder {
    color: transparent;
}

@media (max-width: 767px) {
    .card {
        width: 90%;
        padding: 1.5rem;
    }
}

@media (max-width: 1366px) {
    .card {
        width: 90%;
        padding: 8vh;
}
}
</style>